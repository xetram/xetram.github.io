<script type="text/javascript">
    // Note that this file should not contain definitions for page-specific variables. Reason: Hugo builds this partial just once and includes it everywhere.
    let baseURL = "{{.Site.BaseURL}}";
    let basePath = "/" + baseURL.split("/").slice(3).join("/");
    let siteParams = JSON.parse("{{.Site.Params | jsonify}}");
    let pageDefaultsList = JSON.parse("{{.Site.Data.page_defaults | jsonify}}");
    let sidebarsData = JSON.parse("{{$.Site.Data.sidebars | jsonify}}");
    let autocompletePageUrl = "{{ "data/pages.tsv" | relURL }}";

    var pageUrlToParams = new Map();
    // Note that only pages parsed and generated by jekyll are processed below - not ready files like pdf-s and htmls.
    // PS: {{.URL}} includes the subpath bit of the baseUrl, hence we subtract it from absUrl. 
    {{ range $.Site.Pages  }}
    {{ $absUrl := .URL | absURL }}{{ $urlMinusBase := replace $absUrl .Site.BaseURL "/" }}
    pageUrlToParams.set("{{$urlMinusBase}}", JSON.parse("{{.Params | jsonify}}"));
    {{ end }}

    var pageUrlToFileParams = new Map();
    // Note that only pages parsed and generated by jekyll are processed below - not ready files like pdf-s and htmls.
    // PS: {{.URL}} includes the subpath bit of the baseUrl, hence we subtract it from absUrl. 
    {{ range $.Site.Pages  }}
    {{ $absUrl := .URL | absURL }}{{ $urlMinusBase := replace $absUrl .Site.BaseURL "/" }}
    pageUrlToFileParams.set("{{$urlMinusBase}}", JSON.parse(`{
      "path": "{{.File.Path}}",
      "logicalName": "{{.File.LogicalName}}",
      "baseFileName": "{{.File.BaseFileName}}",
      "dir": "{{.File.Dir}}"
    }`));
    {{ end }}

    // For directory listing:
    var pageDirectoryToUrl = {};
    // Can this be reliably filled using pageUrlToTitle? No - one cannot distinguish x/y/z/_index.md files as belonging to x/y/z/ since they get the url x/y/z/ just like any other page x/y/w/. 

    function addToPageDirectoryToUrlMap(dirPath, pageUrlTmp) {
        if (pageDirectoryToUrl.hasOwnProperty(dirPath)) {
            pageDirectoryToUrl[dirPath].push(pageUrlTmp);
        } else {
            pageDirectoryToUrl[dirPath] = [pageUrlTmp];
        }
    }
    // Note that only pages parsed and generated by jekyll are processed below - not ready files like pdf-s and htmls.
    // PS: {{.URL}} includes the subpath bit of the baseUrl, hence we subtract it from absUrl. 
    {{ range $.Site.Pages  }} {{ $absUrl := .URL | absURL }}{{ $urlMinusBase := replace $absUrl .Site.BaseURL "/" }}
    addToPageDirectoryToUrlMap("/{{ (path.Split .Path).Dir }}", "{{$urlMinusBase}}");
    {{ end }}

</script>
